package ru.kpfu.itis.ibragimov.controllers;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import ru.kpfu.itis.ibragimov.client.HttpClient;
import ru.kpfu.itis.ibragimov.client.HttpClientImpl;
import ru.kpfu.itis.ibragimov.models.TimeBuses;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/bus")
public class BusServlet extends HttpServlet {

  private final static String URL = "http://data.kzn.ru:8082/api/v0/dynamic_datasets/bus.json";

  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

    HttpClient client = new HttpClientImpl();
    String busResponse = client.get(URL, null, null);
//      String busResponse = "[\n" +
//        "{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2772\",\"Marsh\":\"30\",\"Graph\":\"11\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.800787\",\"Longitude\":\"49.010757\",\"Speed\":\"0\",\"Azimuth\":\"87\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2550\",\"Marsh\":\"45\",\"Graph\":\"13\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.788214\",\"Longitude\":\"49.219768\",\"Speed\":\"0\",\"Azimuth\":\"348\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2551\",\"Marsh\":\"45\",\"Graph\":\"8\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.836095\",\"Longitude\":\"49.121866\",\"Speed\":\"0\",\"Azimuth\":\"288\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2190\",\"Marsh\":\"68\",\"Graph\":\"6\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.756595\",\"Longitude\":\"49.176158\",\"Speed\":\"54\",\"Azimuth\":\"76\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2561\",\"Marsh\":\"22\",\"Graph\":\"2\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.787956\",\"Longitude\":\"49.151924\",\"Speed\":\"25\",\"Azimuth\":\"103\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2741\",\"Marsh\":\"31A\",\"Graph\":\"3\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.745415\",\"Longitude\":\"49.21713\",\"Speed\":\"1\",\"Azimuth\":\"277\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2781\",\"Marsh\":\"31\",\"Graph\":\"17\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.701363\",\"Longitude\":\"49.068452\",\"Speed\":\"41\",\"Azimuth\":\"269\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2769\",\"Marsh\":\"18\",\"Graph\":\"17\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.788778\",\"Longitude\":\"49.224932\",\"Speed\":\"18\",\"Azimuth\":\"95\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2581\",\"Marsh\":\"1\",\"Graph\":\"10\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.835792\",\"Longitude\":\"49.195024\",\"Speed\":\"39\",\"Azimuth\":\"25\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2437\",\"Marsh\":\"18\",\"Graph\":\"22\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.775848\",\"Longitude\":\"49.231787\",\"Speed\":\"3\",\"Azimuth\":\"359\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2125\",\"Marsh\":\"60\",\"Graph\":\"13\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.86558\",\"Longitude\":\"49.002015\",\"Speed\":\"0\",\"Azimuth\":\"279\"}},{\"updated_at\": \"2021-12-01 10:01:57 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2566\",\"Marsh\":\"22\",\"Graph\":\"3\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:57\",\"Latitude\":\"55.792628\",\"Longitude\":\"49.155436\",\"Speed\":\"15\",\"Azimuth\":\"236\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2528\",\"Marsh\":\"45\",\"Graph\":\"21\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.734803\",\"Longitude\":\"49.180311\",\"Speed\":\"33\",\"Azimuth\":\"227\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2577\",\"Marsh\":\"22\",\"Graph\":\"22\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.722681\",\"Longitude\":\"49.17232\",\"Speed\":\"29\",\"Azimuth\":\"22\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2503\",\"Marsh\":\"23\",\"Graph\":\"7\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.730338\",\"Longitude\":\"49.148923\",\"Speed\":\"50\",\"Azimuth\":\"283\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2745\",\"Marsh\":\"91\",\"Graph\":\"8\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.78927\",\"Longitude\":\"49.107577\",\"Speed\":\"12\",\"Azimuth\":\"322\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2704\",\"Marsh\":\"18\",\"Graph\":\"23\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.749275\",\"Longitude\":\"49.225117\",\"Speed\":\"0\",\"Azimuth\":\"53\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2532\",\"Marsh\":\"45\",\"Graph\":\"28\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.835903\",\"Longitude\":\"49.133178\",\"Speed\":\"0\",\"Azimuth\":\"97\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2739\",\"Marsh\":\"77\",\"Graph\":\"6\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.78223\",\"Longitude\":\"49.224587\",\"Speed\":\"0\",\"Azimuth\":\"89\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2580\",\"Marsh\":\"22\",\"Graph\":\"8\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.832876\",\"Longitude\":\"49.08013\",\"Speed\":\"13\",\"Azimuth\":\"172\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2770\",\"Marsh\":\"77\",\"Graph\":\"1\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.742983\",\"Longitude\":\"49.136218\",\"Speed\":\"41\",\"Azimuth\":\"276\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2738\",\"Marsh\":\"5\",\"Graph\":\"14\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.742023\",\"Longitude\":\"49.193528\",\"Speed\":\"2\",\"Azimuth\":\"222\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2712\",\"Marsh\":\"31\",\"Graph\":\"13\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.782238\",\"Longitude\":\"49.223018\",\"Speed\":\"0\",\"Azimuth\":\"80\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2160\",\"Marsh\":\"71\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.797153\",\"Longitude\":\"49.241917\",\"Speed\":\"48\",\"Azimuth\":\"66\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2510\",\"Marsh\":\"18\",\"Graph\":\"13\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.745537\",\"Longitude\":\"49.216805\",\"Speed\":\"16\",\"Azimuth\":\"318\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2502\",\"Marsh\":\"31\",\"Graph\":\"10\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.749264\",\"Longitude\":\"49.105027\",\"Speed\":\"19\",\"Azimuth\":\"359\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2774\",\"Marsh\":\"60\",\"Graph\":\"7\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.842378\",\"Longitude\":\"49.085837\",\"Speed\":\"11\",\"Azimuth\":\"83\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2431\",\"Marsh\":\"5\",\"Graph\":\"10\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.770522\",\"Longitude\":\"49.143647\",\"Speed\":\"42\",\"Azimuth\":\"150\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2756\",\"Marsh\":\"31\",\"Graph\":\"9\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.778977\",\"Longitude\":\"49.110622\",\"Speed\":\"14\",\"Azimuth\":\"219\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2748\",\"Marsh\":\"18\",\"Graph\":\"15\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.779868\",\"Longitude\":\"49.172342\",\"Speed\":\"22\",\"Azimuth\":\"8\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2444\",\"Marsh\":\"60\",\"Graph\":\"16\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.859467\",\"Longitude\":\"49.102253\",\"Speed\":\"18\",\"Azimuth\":\"299\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2463\",\"Marsh\":\"68\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.780575\",\"Longitude\":\"49.264277\",\"Speed\":\"25\",\"Azimuth\":\"167\"}},{\"updated_at\": \"2021-12-01 10:02:40 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"12680\",\"Marsh\":\"55\",\"Graph\":\"6\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:02:40\",\"Latitude\":\"55.835317\",\"Longitude\":\"49.120983\",\"Speed\":\"0\",\"Azimuth\":\"101\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2432\",\"Marsh\":\"30\",\"Graph\":\"25\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.765243\",\"Longitude\":\"49.231707\",\"Speed\":\"54\",\"Azimuth\":\"360\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2542\",\"Marsh\":\"45\",\"Graph\":\"7\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.797667\",\"Longitude\":\"49.044204\",\"Speed\":\"45\",\"Azimuth\":\"115\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2505\",\"Marsh\":\"71\",\"Graph\":\"3\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.811128\",\"Longitude\":\"49.267073\",\"Speed\":\"0\",\"Azimuth\":\"206\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2442\",\"Marsh\":\"30\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.775892\",\"Longitude\":\"49.174693\",\"Speed\":\"30\",\"Azimuth\":\"139\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2538\",\"Marsh\":\"45\",\"Graph\":\"1\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.721297\",\"Longitude\":\"49.171543\",\"Speed\":\"0\",\"Azimuth\":\"1\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2728\",\"Marsh\":\"45\",\"Graph\":\"18\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.802438\",\"Longitude\":\"48.959138\",\"Speed\":\"47\",\"Azimuth\":\"238\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2543\",\"Marsh\":\"45\",\"Graph\":\"24\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.752828\",\"Longitude\":\"49.230752\",\"Speed\":\"39\",\"Azimuth\":\"209\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2757\",\"Marsh\":\"60\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.825628\",\"Longitude\":\"49.154927\",\"Speed\":\"8\",\"Azimuth\":\"114\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2518\",\"Marsh\":\"90\",\"Graph\":\"2\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.7455\",\"Longitude\":\"49.216352\",\"Speed\":\"6\",\"Azimuth\":\"130\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2105\",\"Marsh\":\"30\",\"Graph\":\"17\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.786925\",\"Longitude\":\"49.166223\",\"Speed\":\"27\",\"Azimuth\":\"258\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2423\",\"Marsh\":\"18\",\"Graph\":\"9\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.826178\",\"Longitude\":\"49.154473\",\"Speed\":\"2\",\"Azimuth\":\"284\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2737\",\"Marsh\":\"5\",\"Graph\":\"13\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.760477\",\"Longitude\":\"49.188785\",\"Speed\":\"3\",\"Azimuth\":\"349\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2587\",\"Marsh\":\"22\",\"Graph\":\"17\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.796414\",\"Longitude\":\"49.123266\",\"Speed\":\"13\",\"Azimuth\":\"277\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2733\",\"Marsh\":\"91\",\"Graph\":\"7\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.792778\",\"Longitude\":\"49.099458\",\"Speed\":\"0\",\"Azimuth\":\"24\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2150\",\"Marsh\":\"23\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.790908\",\"Longitude\":\"49.103077\",\"Speed\":\"0\",\"Azimuth\":\"223\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2763\",\"Marsh\":\"18\",\"Graph\":\"25\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.785738\",\"Longitude\":\"49.170882\",\"Speed\":\"15\",\"Azimuth\":\"178\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2778\",\"Marsh\":\"31\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.702823\",\"Longitude\":\"49.084982\",\"Speed\":\"42\",\"Azimuth\":\"253\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2547\",\"Marsh\":\"45\",\"Graph\":\"9\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.836219\",\"Longitude\":\"49.147064\",\"Speed\":\"27\",\"Azimuth\":\"298\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2468\",\"Marsh\":\"4\",\"Graph\":\"2\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.789108\",\"Longitude\":\"49.151905\",\"Speed\":\"0\",\"Azimuth\":\"347\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2567\",\"Marsh\":\"1\",\"Graph\":\"2\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.792058\",\"Longitude\":\"49.152646\",\"Speed\":\"45\",\"Azimuth\":\"198\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2526\",\"Marsh\":\"91\",\"Graph\":\"15\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.863375\",\"Longitude\":\"49.220117\",\"Speed\":\"0\",\"Azimuth\":\"191\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2553\",\"Marsh\":\"45\",\"Graph\":\"3\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.797295\",\"Longitude\":\"49.046084\",\"Speed\":\"48\",\"Azimuth\":\"272\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2713\",\"Marsh\":\"5\",\"Graph\":\"25\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.780557\",\"Longitude\":\"49.113417\",\"Speed\":\"22\",\"Azimuth\":\"46\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2576\",\"Marsh\":\"1\",\"Graph\":\"16\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.781028\",\"Longitude\":\"49.130722\",\"Speed\":\"6\",\"Azimuth\":\"319\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2758\",\"Marsh\":\"60\",\"Graph\":\"1\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.842762\",\"Longitude\":\"49.20258\",\"Speed\":\"11\",\"Azimuth\":\"38\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2527\",\"Marsh\":\"45\",\"Graph\":\"25\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.782301\",\"Longitude\":\"49.219869\",\"Speed\":\"10\",\"Azimuth\":\"41\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2422\",\"Marsh\":\"30\",\"Graph\":\"8\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.786158\",\"Longitude\":\"49.111208\",\"Speed\":\"19\",\"Azimuth\":\"153\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2767\",\"Marsh\":\"18\",\"Graph\":\"5\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.83452\",\"Longitude\":\"49.089797\",\"Speed\":\"26\",\"Azimuth\":\"169\"}},{\"updated_at\": \"2021-12-01 10:01:51 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2425\",\"Marsh\":\"18\",\"Graph\":\"12\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:51\",\"Latitude\":\"55.829658\",\"Longitude\":\"49.081327\",\"Speed\":\"0\",\"Azimuth\":\"157\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2415\",\"Marsh\":\"4\",\"Graph\":\"6\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.741208\",\"Longitude\":\"49.191913\",\"Speed\":\"7\",\"Azimuth\":\"220\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2128\",\"Marsh\":\"34\",\"Graph\":\"5\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.77458\",\"Longitude\":\"49.231713\",\"Speed\":\"24\",\"Azimuth\":\"0\"}},{\"updated_at\": \"2021-12-01 10:01:55 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2710\",\"Marsh\":\"5\",\"Graph\":\"17\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:55\",\"Latitude\":\"55.761873\",\"Longitude\":\"49.231337\",\"Speed\":\"22\",\"Azimuth\":\"171\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2114\",\"Marsh\":\"60\",\"Graph\":\"20\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.867228\",\"Longitude\":\"49.232913\",\"Speed\":\"0\",\"Azimuth\":\"72\"}},{\"updated_at\": \"2021-12-01 10:01:54 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2447\",\"Marsh\":\"34\",\"Graph\":\"1\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:54\",\"Latitude\":\"55.774857\",\"Longitude\":\"49.231623\",\"Speed\":\"11\",\"Azimuth\":\"180\"}},{\"updated_at\": \"2021-12-01 10:01:52 (Europe/Moscow)\", \"data\": {\"GaragNumb\":\"2146\",\"Marsh\":\"25\",\"Graph\":\"4\",\"Smena\":\"1\",\"TimeNav\":\"01.12.2021 10:01:52\",\"Latitude\":\"55.743058\",\"Longitude\":\"49.133103\",\"Speed\":\"23\",\"Azimuth\":\"329\"}}\n" +
//        "]";

    resp.setContentType("text/plain");
    resp.setCharacterEncoding("UTF-8");

    String marsh = req.getParameter("text");

    if (busResponse != null) {

      GsonBuilder builder = new GsonBuilder();
      Gson gson = builder.create();
      TimeBuses[] parsedBusResponse = gson.fromJson(busResponse, TimeBuses[].class);
//      System.out.println(gson.toJson(parsedBusResponse));

      for (TimeBuses timeBuses : parsedBusResponse) {
        if (marsh.equals(timeBuses.getData().getMarsh())) {
          resp.getWriter().write( timeBuses.getData().getGaragNumb() + "-" + timeBuses.getData().getLatitude() + "-" + timeBuses.getData().getLongitude() + " ");
        }
      }
    }
  }
}
